package com.vip.apitest.luxury.magento;

import static com.jayway.restassured.RestAssured.given;
import static com.jayway.restassured.module.jsv.JsonSchemaValidator.matchesJsonSchema;
import static org.hamcrest.Matchers.equalTo;

import java.io.InputStream;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

import org.junit.Before;
import org.junit.Test;

import com.jayway.restassured.RestAssured;
import com.vip.apitest.luxury.common.CommonMethod;
import com.vip.apitest.utility.MD5Encoder;

public class ShopConfirmationTest {
	
	 @Before
		public void setUp() throws Exception{
			RestAssured.baseURI = "http://192.168.44.79";
			RestAssured.port = 80;
			CommonMethod.getUidAndToken();
		}
	
	@Test
	public void testShopConfirmationAtion() throws NoSuchAlgorithmException{
		System.out.println("根据手机号显示用户的预约商品列表");
		InputStream jsonSchema = Thread.currentThread().getContextClassLoader().getResourceAsStream("shop_confirmation.json");
		String sign = MD5Encoder.encodeByMD5("shop" + "confirmation" + "viplux#123@", MessageDigest.getInstance("MD5"));
		given().
			params("sign", sign).
			params("appid", CommonMethod.appid).
			params("shop_id", "10001").
			params("phone", "18501010101").
			params("staff", "1010000").
			params("uid", CommonMethod.uid).
			params("token", CommonMethod.token).
		when().
			get("/shop/confirmation/").prettyPrint();
//		then().
//			statusCode(200).
//			body("code", equalTo(1)).
//			body(matchesJsonSchema(jsonSchema));			
	}
}
