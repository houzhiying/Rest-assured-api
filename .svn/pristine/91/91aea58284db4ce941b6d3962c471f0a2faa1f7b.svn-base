package com.vip.apitest.utility.db;
import java.sql.ResultSet;

public class AutoCreateExtractor {

	String lname;
	String doname;
	String ldoname;
	String listname;

	public AutoCreateExtractor(String name) {
		this.lname = name;
		int i = lname.indexOf("_");
		while (i > 0) {
			lname = lname.substring(0, i)
					+ lname.substring(i + 1, i + 2).toUpperCase()
					+ lname.substring(i + 2);
			i = lname.indexOf("_");
		}
		this.doname = lname.substring(0, 1).toUpperCase() + lname.substring(1)
				+ "DO";
		this.ldoname = lname + "DO";
		this.listname = lname + "List";
	}

	public void outPrintHead() {
		System.out.println("import java.sql.ResultSet;");
		System.out.println("import java.sql.SQLException;");
		System.out.println("import java.util.ArrayList;");
		System.out.println("");
		System.out
				.println("import org.springframework.dao.DataAccessException;");
		System.out
				.println("import org.springframework.jdbc.core.ResultSetExtractor;");
		System.out.println("");
		System.out.println("");
		System.out.println("public class " + doname + "Extractor"
				+ " implements ResultSetExtractor {");
		System.out.println("	");
		System.out.println("	@Override");
		System.out
				.println("	public Object extractData(ResultSet rs) throws SQLException,DataAccessException {");
		System.out.println("		ArrayList<" + doname + "> " + listname
				+ " = new ArrayList<" + doname + ">();");
		System.out.println("		while (rs.next()) {");
		System.out.println("			" + doname + " " + ldoname + " = new " + doname
				+ "();");
	}
	
	public void outPrintFeet() {
		System.out.println("			"+listname+".add("+ldoname+");");
		System.out.println("		}");
		System.out.println("		return "+listname+";");
		System.out.println("	}");
		System.out.println("}");
	}

	public String transString(String clname) {
		String name = "";
		String s1 = clname;
		String[] s = s1.split("_");
		for (int i = 0; i < s.length; i++) {
			name += s[i].substring(0, 1).toUpperCase() + s[i].substring(1);
		}
		return name;
	}

	public void getTable(String tablename) {
		ResultSet rs;
		ConnectionFactoryForMySql conn =  new ConnectionFactoryForMySql("vipshop","dWwkv%+!1cQf$FNy","192.168.201.122","3306","information_schema");
		conn.DbConnection();
		rs = conn
				.executeQuery("SELECT COLUMN_NAME, DATA_TYPE FROM COLUMNS WHERE TABLE_NAME = 'brand'");
		try {
			if(!rs.next()){
				System.out.println("~~~~");
			} else {
				while (rs.next()) {
					String setname = "set"
							+ transString(rs.getString("COLUMN_NAME")
									.toLowerCase());
					System.out.print("			" + ldoname + "." + setname
							+ "(rs.get");
					if (rs.getString("DATA_TYPE").equals("NUMBER")) {
						System.out.print("Long");
					} else if (rs.getString("DATA_TYPE").equals("DATE")) {
						System.out.print("Date");
					} else {
						System.out.print("String");
					}
					System.out.print("(\"" + rs.getString("COLUMN_NAME")
							+ "\"));");
					System.out.println();
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		conn.close();
	}


	
	public static void main(String[] args) {
		String tableName = "brand";
		AutoCreateExtractor auto = new AutoCreateExtractor(tableName);
		auto.outPrintHead();
		auto.getTable(tableName);
		auto.outPrintFeet();
	}

}
